---
title: Context Management for Multi-Session Continuity
tags: [context, memory, mcp, workflow]
priority: high
applies: always
alwaysApply: true
---

# Context Management Rules

**⚠️ ALWAYS APPLY:** Use direct file operations for writing, MCP tools for reading.

## Quick Start (Every Session)

**1. List available contexts to see what we have:**
```
list_context
```

**2. Read core contexts to understand where we are:**
```
get_context names=["project-overview", "current-status"]
```

**3. Work on your task**

**3. Update contexts directly (fast, streaming UX):**
```python
# Write .mdc files directly (NOT put_context - it's slow)
write("out_of_context/contexts/current-status.mdc", """---
name: current-status
type: status
last-updated: 2024-12-16
---

# Current Status

[Updated content here...]
""")
```

---

## Write: Use Direct File Operations (Fast)

**Create/Update Context:**
```python
write("out_of_context/contexts/my-context.mdc", """---
name: my-context
type: info
created_at: 2024-12-16T10:00:00
---

# Content
""")
```

**Update Part of Context:**
```python
search_replace(
    file_path="out_of_context/contexts/current-status.mdc",
    old_string="old content",
    new_string="new content"
)
```

**Delete Context:**
```python
delete_file("out_of_context/contexts/old-context.mdc")
```

---

## Read: Use MCP Tools

**List all contexts:**
```
list_context
```

**Fetch specific contexts (single or bulk):**
```
get_context names=["project-overview", "current-status"]
```

**Search contexts:**
```
search_context query="database selection"
```

---

## .mdc File Format

```markdown
---
name: context-name (required, must match filename)
type: project-info|status|decision (optional)
created_at: 2024-12-16T10:00:00 (optional)
custom-field: value (optional)
---

# Markdown Content

Your content here...
```

**Rules:**
- `name` field must match filename (without .mdc)
- File watcher auto-adds `created_at` if missing
- File watcher validates and auto-corrects metadata

---

## Atomicity Principle

**Keep contexts small and focused:**
- ✅ **One topic per context** (< 200 lines ideal, < 300 lines max)
- ✅ **Split when multiple topics emerge** (database choice vs workflow revision = 2 contexts)
- ✅ **Use descriptive names** (`decision-database-chromadb` not `decision-log`)
- ✅ **Group related decisions by timeframe or category**

**When to split:**
- Context exceeds 300 lines
- Contains 3+ distinct topics
- Historical decisions + active work mixed together
- Different audiences (scientist vs developer decisions)

**Naming conventions:**
- `decision-{topic}-{date}` - Specific decision (e.g., `decision-database-2024-12-16`)
- `{topic}-status` - Current status of a topic (e.g., `database-status`)
- `{topic}-overview` - High-level summary (e.g., `project-overview`)
- `history-{topic}` - Historical record (e.g., `history-decisions-phase0`)

---

## Core Contexts

**Always read at session start:**
- `project-overview` - What is this project?
- `current-status` - Where are we now?

**Read as needed (phase-specific):**
- `decision-*` - Specific decisions (e.g., `decision-database-2024-12-16`)
- `history-*` - Historical records (e.g., `history-decisions-phase0`)
- `action-items-revised` - Current workflow

**Update at session end:**
- `current-status` - Update progress
- `decision-{new-topic}` - Document NEW decisions (create specific context)

---

## Why Direct File Operations?

1. **20-60x faster** - Streaming UX (1-3s → 20-50ms)
2. **Users see progress** - Watch content being drafted
3. **Metadata consistency maintained** - File watcher auto-corrects
4. **Simpler** - No MCP tool abstraction layer

**File watcher handles:**
- Auto-adds missing `created_at`
- Validates `name` matches filename
- Generates embeddings for search
- Updates vector database

---

## Golden Rules

1. ✅ **Read:** Use `list_context` to see all contexts, then `get_context` to fetch specific ones (MCP tools)
2. ✅ **Write:** Use `write`/`search_replace` (direct file ops)
3. ✅ **Delete:** Use `delete_file` (direct file ops)
4. ✅ **Fetch 2-5 contexts** per session (avoid flooding window)
5. ✅ **Update at session end** (prevent staleness)
6. ✅ **Keep contexts atomic** (< 200 lines ideal, split if > 300 lines)
7. ✅ **Split by topic** (one decision = one context)
8. ❌ **DON'T use `put_context`** (slow, being removed in v2.0)
9. ❌ **DON'T concatenate unrelated topics** (split instead)
