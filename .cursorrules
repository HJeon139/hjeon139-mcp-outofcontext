# Cursor Rules for Out of Context Project

This file provides guidelines for AI-assisted development in Cursor.

## Commit Standards

Always follow Conventional Commits format when making commits:

- Format: `<type>(<scope>): <subject>`
- Types: feat, fix, docs, style, refactor, perf, test, build, ci, chore, revert
- Scope examples: foundation, models, server, storage, gc, tools, tests
- Subject: imperative mood, lowercase, max 72 chars

See: `docs/steering/06_conventional_commits.md`

## Version Management

When making commits, bump version appropriately:

- `feat` commits → Bump MINOR version (0.1.0 → 0.2.0)
- `fix` commits → Bump PATCH version (0.1.0 → 0.1.1)
- Breaking changes → Bump MAJOR version (0.1.0 → 1.0.0)
- Update in both: `pyproject.toml` and `src/out_of_context/__init__.py`

See: `docs/steering/07_semantic_versioning.md`

## Commit Workflow

1. Make code changes
2. Determine commit type (feat/fix/docs/etc.)
3. Choose scope
4. Bump version if needed (feat/fix/breaking)
5. Write commit message in conventional format
6. Stage and commit

See: `docs/steering/08_commit_version_workflow.md`

## Code Quality

- Use ruff for linting and formatting
- Type hints required for all functions
- All tests must pass before committing
- Follow FastAPI/MCP best practices (no globals, dependency injection)
- **File Size Rule**: Keep files under ~400 lines of code (max recommended: 400 lines)
  - When a file exceeds 400 lines, split it into logical modules with clear separation of concerns
  - Use subdirectories for related functionality (e.g., `tools/`, `storage/`)
  - Group related handlers/functions into separate modules within a package
  - File names should match their purpose following PEP 8 standards (snake_case)
  - Maintain backward compatibility by re-exporting from `__init__.py` if needed
  - **Examples**:
    - `tools/pruning/` directory for pruning tool handlers (one file per handler)
    - `storage/` directory split into `file_operations.py`, `indexing.py`, `segment_operations.py`
    - Keep main classes in `__init__.py` if they compose sub-modules

## File Organization

- Source code: `src/hjeon139_mcp_outofcontext/`
  - `tools/` - MCP tool handlers organized by functionality
    - `tools/monitoring.py` - Monitoring tool handlers
    - `tools/pruning/` - Pruning tool handlers (one per file)
  - `storage/` - Storage layer organized by operation type
    - `storage/file_operations.py` - File I/O operations
    - `storage/indexing.py` - Indexing operations
    - `storage/segment_operations.py` - Segment CRUD operations
- Tests: `tests/` (mirror source structure)
- Documentation: `docs/`
- Steering docs: `docs/steering/`

## Testing

- Run tests: `hatch run test`
- All tests must pass before committing
- Use pytest markers: `@pytest.mark.unit`, `@pytest.mark.integration`

## Dependencies

- Minimal dependencies: mcp, pydantic, tiktoken
- Dev dependencies: pytest, pytest-asyncio, ruff, mypy, pre-commit
- Add new dependencies only when necessary

## References

- Steering Documentation: `docs/steering/`
- Task Documentation: `docs/v1/tasks/`
- Design Documentation: `docs/v1/design/`

